/**
 * ruban v0.5.0
 *
 * Copyright (c) 2013 Lo√Øc Frering <loic.frering@gmail.com>
 * Distributed under the MIT license
 */
(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=[].slice;b="__change",a=function(){function a(a){var b=this;this.options=null!=a?a:{},this.applyChange=c(this.applyChange,this),this.propagateChange=c(this.propagateChange,this),this.updateTime=c(this.updateTime,this),this.togglePresenterMode=c(this.togglePresenterMode,this),this.next=c(this.next,this),this.last=c(this.last,this),this.toggleDetails=c(this.toggleDetails,this),this.prev=c(this.prev,this),this.first=c(this.first,this),this.checkHash=c(this.checkHash,this),this.resize=c(this.resize,this),this.initOptions(),this.$sections=$("section").wrapAll('<div class="ruban"></div>'),this.$ruban=$(".ruban"),this.toc(),this.current(this.$sections.first()),this.pagination(),this.highlight(),this.resize(),this.bind(),this.$ruban.css("transition-property","transform"),this.$ruban.css("-webkit-transition-property","-webkit-transform"),setTimeout(function(){return b.checkHash()},250),window.addEventListener("storage",this.applyChange,!1)}return a.prototype.initOptions=function(){var a,b,c,d,e,f,g,h,i;return null==(a=this.options).ratio&&(a.ratio=4/3),null==(b=this.options).minPadding&&(b.minPadding="0.4em"),null==(c=this.options).transitionDuration&&(c.transitionDuration="1s"),null==(d=this.options).pagination&&(d.pagination=!1),null==(e=this.options).title&&(e.title=null),null==(f=this.options).stripHtmlInToc&&(f.stripHtmlInToc=!1),null==(g=this.options).bindClicks&&(g.bindClicks=!1),null==(h=this.options).bindMouseWheel&&(h.bindMouseWheel=!1),null!=(i=this.options).fontRatio?(i=this.options).fontRatio:i.fontRatio=.4},a.prototype.bind=function(){return this.bindKeys(),this.bindGestures(),this.options.bindClicks&&this.bindClicks(),this.options.bindMouseWheel&&this.bindMouseWheel(),this.bindResize(),this.bindHashChange()},a.prototype.bindKeys=function(){return key("right, down, space, return, j, l, pagedown",this.next),key("left, up, backspace, k, h, pageup",this.prev),key("home",this.first),key("last",this.last),key("c",this.toggleDetails),key("p",this.togglePresenterMode)},a.prototype.bindGestures=function(){return Hammer(document,{drag_block_vertical:!0,drag_block_horizontal:!0}).on("swipeleft swipeup",this.next).on("swiperight swipedown",this.prev)},a.prototype.bindClicks=function(){var a=this;return this.$ruban.contextmenu(function(){return!1}),this.$ruban.mousedown(function(b){switch(b.which){case 1:return a.next();case 3:return a.prev()}})},a.prototype.bindMouseWheel=function(){var a=this;return this.$ruban.on("wheel",function(b){return b.originalEvent.deltaY>0?a.next():b.originalEvent.deltaY<0?a.prev():void 0})},a.prototype.bindResize=function(){var a=this;return $(window).resize(function(){return a.resize(),a.go(a.$current,{force:!0})})},a.prototype.bindHashChange=function(){return $(window).on("hashchange",this.checkHash)},a.prototype.resize=function(){var a,b,c,d,e,f,g,h,i;return g=this.$slides||$(window),i=[g.width(),g.height()],d=i[0],c=i[1],d>this.options.ratio*c?(b=c,f=this.options.minPadding,this.$ruban.parent().css("font-size",""+b*this.options.fontRatio+"%"),this.$sections.css({"padding-top":f,"padding-bottom":f}),a=this.$current.height(),h=this.options.ratio*a,e=""+(d-h)/2+"px",this.$sections.css({"padding-left":e,"padding-right":e})):(b=d/this.options.ratio,e=this.options.minPadding,this.$ruban.parent().css("font-size",""+b*this.options.fontRatio+"%"),this.$sections.css({"padding-left":e,"padding-right":e}),h=this.$current.width(),a=h/this.options.ratio,f=""+(c-a)/2+"px",this.$sections.css({"padding-top":f,"padding-bottom":f}))},a.prototype.checkHash=function(){var a,b;return a=window.location.hash,(b=a.substr(2))?this.go(b,{immediate:!0}):void 0},a.prototype.highlight=function(){return hljs.initHighlightingOnLoad()},a.prototype.first=function(){return this.firstSlide()},a.prototype.firstSlide=function(){var a;return a=this.$current.prevAll("section:first-child"),this.go(a,{direction:"backward"})},a.prototype.prev=function(){return this.hasSteps()?this.prevStep():this.prevSlide()},a.prototype.prevSlide=function(){var a;return a=this.$current.prev("section"),this.go(a,{direction:"backward"})},a.prototype.prevStep=function(){var a;return this.$steps.eq(this.index).removeClass("step").fadeOut(),a=this.$steps.eq(--this.index),this.index<-1?this.prevSlide():(a.is(":visible")?a.addClass("step").trigger("step"):this.index>-1&&this.prevStep(),this.propagateChange("prevStep"))},a.prototype.toggleDetails=function(){return this.$current.find("details").toggleClass("opened")},a.prototype.last=function(){return this.lastSlide()},a.prototype.lastSlide=function(){var a;return a=this.$current.nextAll("section:last-child"),this.go(a,{direction:"forward"})},a.prototype.next=function(){return this.hasSteps()?this.nextStep():this.nextSlide()},a.prototype.nextSlide=function(){var a;return a=this.$current.next("section"),this.go(a,{direction:"forward"})},a.prototype.nextStep=function(){var a,b;return this.$steps.eq(this.index).removeClass("step"),a=this.$steps.eq(++this.index),a.length?(a.fadeIn().addClass("step").trigger("step"),b=Math.random(),this.propagateChange("nextStep")):this.nextSlide()},a.prototype.checkSteps=function(a,b){return this.$steps=a.find(".steps").children(),this.$steps.length||(this.$steps=a.find(".step")),"backward"===b?this.index=this.$steps.length-1:(this.index=-1,this.$steps.hide())},a.prototype.hasSteps=function(){return null!=this.$steps&&0!==this.$steps.length},a.prototype.find=function(a){var b;return a instanceof $?a:(b=$("#"+a),0===b.length&&(b=this.$sections.eq(parseInt(a)-1)),b)},a.prototype.go=function(a,b){var c;return null==a&&(a=1),null==b&&(b={}),c=this.find(a),!c.length||!b.force&&c.is(this.$current)?void 0:(this.checkSteps(c,b.direction),this.navigate(c),this.translate(c,b.immediate),this.current(c),this.pagination(),this.$ruban.trigger("change",{current:this.$current}),this.propagateChange("go",window.location.hash.replace(/#\//,""),b))},a.prototype.navigate=function(a){return window.location.hash="/"+(a.attr("id")||a.index()+1)},a.prototype.translate=function(a,b){var c;return null==b&&(b=!1),c=a.prevAll().map(function(){return $(this).outerHeight()}).get().reduce(function(a,b){return a+b},0),this.$ruban.css("transition-duration",b?0:this.options.transitionDuration),this.$ruban.css("transform","translateY(-"+c+"px)")},a.prototype.current=function(a){return null!=this.$current&&this.$current.removeClass("active").trigger("inactive"),a.addClass("active").trigger("active"),this.$current=a,this.$comments?(this.$comments.empty().append(a.find("details").clone()),this.$commands.find(".timing").data("timing",60*+a.data("timing"))):void 0},a.prototype.pagination=function(){return this.paginationText=[],this.options.title&&this.paginationText.push(this.options.title),null!=this.$slides||this.options.pagination||this.options.title?(this.$pagination||(this.$pagination=$('<footer class="pagination"></footer>').appendTo(this.$commands||this.$ruban.parent()),this.total=this.$sections.length),this.options.pagination&&this.paginationText.push(""+(this.$current.index()+1)+"/"+this.total),this.$pagination.html(this.paginationText.join(" - "))):void 0},a.prototype.toc=function(){var a,b,c;return a=$(".toc").first(),a.length?(c=this.options.stripHtmlInToc,b=$("<ul/>"),$("section:not(.no-toc,.toc) > h1:only-child").each(function(){var a,d,e,f;return d=$(this).parent(),c?f=e=$(this).text():(a=$(this).clone().find("a").replaceWith(function(){return $(this).text()}).end(),f=a.text(),e=a.html()),$("<li/>").append($("<a/>",{href:"#/"+(d.attr("id")||d.index()+1),title:f,html:e})).appendTo(b)}),a.append(b)):void 0},a.prototype.togglePresenterMode=function(){var a,b;return null!=(b=this.$pagination)&&b.remove(),delete this.$pagination,a=null!=this.$slides,a?($("body").removeClass("presenter").append(this.$ruban),this.$commands.remove(),this.$comments.remove(),this.$slides.remove(),delete this.$comments,delete this.$commands,delete this.$slides):($("body").addClass("presenter").css("font-size",""),this.$slides=$("<article>").appendTo("body"),this.$slides.append(this.$ruban),this.$comments=$("<aside>").appendTo("body"),this.$commands=$("<header>").appendTo("body"),this.$commands.append('<div class="time"></div><div class="time-left"><span class="timing"></span> left</div>'),this.current(this.$current),this.updateTime()),this.pagination(),this.resize(),this.$ruban.trigger("toggle-presenter",{active:!a,current:this.$current})},a.prototype.updateTime=function(){var a,b,c,d;return null!=this.$slides&&setTimeout(this.updateTime,1e3),null!=this.$commands?(c=new Date,b=c.getMinutes(),this.$commands.find(".time").html(""+c.getHours()+":"+(10>b?"0"+b:b)),d=this.$commands.find(".timing"),a=+d.data("timing")-1,(isNaN(a)||0>a)&&(a=0),d.html(""+Math.floor(a/60)+"' "+a%60+"''"),d.data("timing",a),d.parent().toggleClass("timeout",10>a)):void 0},a.prototype.propagateChange=function(){var a,c;return c=arguments[0],a=2<=arguments.length?d.call(arguments,1):[],this._propagating?void 0:(a.length||(a=[Math.random()]),localStorage[b]=JSON.stringify({op:c,args:a}))},a.prototype.applyChange=function(a){var c,d,e,f,g;return d=a.key,e=a.newValue,d===b?(g=JSON.parse(e),f=g.op,c=g.args,f in this?(this._propagating=!0,this[f].apply(this,c),delete this._propagating):void 0):void 0},a}(),window.Ruban=a}).call(this);